<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>King James Bible Search</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }

        input,
        button {
            padding: 10px;
            margin: 5px 0;
            width: 100%;
        }

        .results {
            margin-top: 20px;
        }
    </style>
</head>

<body>
    <h1>Search the King James Bible</h1>
    <form id="search-form">
        <label for="search">Enter Bible Reference:</label><br>
        <input type="text" id="search" name="search" placeholder="e.g., Rev 1:1, 1 John 5:7, Rev 1:1-3, Rev 1:1-"
            required><br>
        <button type="submit">Search</button>
    </form>

    <div class="results">
        <h2>Results:</h2>
        <div id="results-container"></div>
    </div>

    <script>
        // Map common abbreviations to full book names
        const bookMapping = {
            'gen': 'Genesis',
            'exod': 'Exodus',
            'lev': 'Leviticus',
            'num': 'Numbers',
            'deut': 'Deuteronomy',
            'josh': 'Joshua',
            'judg': 'Judges',
            'ruth': 'Ruth',
            '1sam': '1 Samuel', '1samuel': '1 Samuel',
            '2sam': '2 Samuel', '2samuel': '2 Samuel',
            '1kgs': '1 Kings', '1kings': '1 Kings',
            '2kgs': '2 Kings', '2kings': '2 Kings',
            '1chr': '1 Chronicles', '1chronicles': '1 Chronicles',
            '2chr': '2 Chronicles', '2chronicles': '2 Chronicles',
            'ezra': 'Ezra',
            'neh': 'Nehemiah',
            'esth': 'Esther',
            'job': 'Job',
            'ps': 'Psalms', 'psalm': 'Psalms',
            'prov': 'Proverbs',
            'eccl': 'Ecclesiastes', 'ecc': 'Ecclesiastes',
            'song': 'Song of Solomon', 'songs': 'Song of Solomon',
            'isa': 'Isaiah',
            'jer': 'Jeremiah',
            'lam': 'Lamentations',
            'ezek': 'Ezekiel',
            'dan': 'Daniel',
            'hos': 'Hosea',
            'joel': 'Joel',
            'amos': 'Amos',
            'obad': 'Obadiah',
            'jonah': 'Jonah',
            'micah': 'Micah',
            'nahum': 'Nahum',
            'hab': 'Habakkuk',
            'zeph': 'Zephaniah',
            'hag': 'Haggai',
            'zech': 'Zechariah',
            'mal': 'Malachi',
            'matt': 'Matthew',
            'mark': 'Mark',
            'luke': 'Luke',
            'john': 'John',
            'acts': 'Acts',
            'rom': 'Romans',
            '1cor': '1 Corinthians', '1corinthians': '1 Corinthians',
            '2cor': '2 Corinthians', '2corinthians': '2 Corinthians',
            'gal': 'Galatians',
            'eph': 'Ephesians',
            'phil': 'Philippians',
            'col': 'Colossians',
            '1thess': '1 Thessalonians', '1thessalonians': '1 Thessalonians',
            '2thess': '2 Thessalonians', '2thessalonians': '2 Thessalonians',
            '1tim': '1 Timothy', '1timothy': '1 Timothy',
            '2tim': '2 Timothy', '2timothy': '2 Timothy',
            'titus': 'Titus',
            'philem': 'Philemon',
            'heb': 'Hebrews',
            'james': 'James',
            '1pet': '1 Peter', '1peter': '1 Peter',
            '2pet': '2 Peter', '2peter': '2 Peter',
            '1john': '1 John', '1jh': '1 John', '1 jn': '1 John',
            '2john': '2 John', '2jh': '2 John',
            '3john': '3 John', '3jh': '3 John',
            'jude': 'Jude',
            'rev': 'Revelation'
        };

        function parseInput(input) {
    const regex = /(\d?\s?\w+)\s*(\d+):(\d+)(?:-(\d+))?|(?:-\s*)$/i;
    const match = input.match(regex);

    if (match) {
        const bookAbbr = match[1].toLowerCase().replace(/\s+/g, '');
        const bookName = bookMapping[bookAbbr] || bookAbbr;
        const chapterId = parseInt(match[2]);
        const startVerseId = parseInt(match[3]);

        // Set endVerseId only if there is a match in the 4th capture group (explicit range)
        // or if no dash is present, indicating a single verse (start_verse_id = end_verse_id).
        let endVerseId;
        if (match[4]) {
            endVerseId = parseInt(match[4]);  // Explicit end verse provided
        } else if (!input.includes('-')) {
            endVerseId = startVerseId;  // No dash, single-verse query
        }

        return { bookName, chapterId, startVerseId, endVerseId };
    } else {
        return null;
    }
}



        document.getElementById('search-form').addEventListener('submit', function (event) {
            event.preventDefault();

            const input = document.getElementById('search').value;
            const parsed = parseInput(input);

            if (!parsed) {
                alert('Invalid input format. Please try again.');
                return;
            }

            const { bookName, chapterId, startVerseId, endVerseId } = parsed;

            // Construct query with start_verse_id, and only add end_verse_id if it's explicitly provided
            let query = `?book_name=${encodeURIComponent(bookName)}&chapter_id=${chapterId}&start_verse_id=${startVerseId}`;
            if (endVerseId !== undefined) {
                query += `&end_verse_id=${endVerseId}`;
            }

            fetch(`/verses${query}`)
                .then(response => response.json())
                .then(data => {
                    const resultsContainer = document.getElementById('results-container');
                    resultsContainer.innerHTML = '';

                    if (data.length === 0) {
                        resultsContainer.innerHTML = '<p>No results found.</p>';
                    } else {
                        data.forEach(group => {
                            const bookHeading = document.createElement('h3');
                            bookHeading.innerText = `${group.book_name} (ID: ${group.book_id})`;
                            resultsContainer.appendChild(bookHeading);

                            group.verses.forEach(verse => {
                                const verseElem = document.createElement('p');
                                verseElem.innerText = `Chapter ${verse.chapter_id}, Verse ${verse.verse_id}: ${verse.verse_text}`;
                                resultsContainer.appendChild(verseElem);
                            });
                        });
                    }
                })
                .catch(error => {
                    console.error('Error fetching verses:', error);
                });
        });



    </script>
</body>

</html>